<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ViboSonic - Genre Prediction</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Inter&display=swap" rel="stylesheet">
</head>

<body class="bg-gradient-to-tr from-gray-900 via-black to-gray-900 text-white min-h-screen flex items-center justify-center">
  <div class="main-glass-box w-full max-w-2xl p-8 glassmorphism-effect rounded-3xl shadow-2xl border border-indigo-500">
    <p class="text-center text-lg font-semibold text-indigo-300 italic mb-6 quote-style">
      | Feel the music. Classify the magic. |
    </p>

    <form id="uploadForm" class="flex flex-col items-center space-y-6">
      <label for="audioFile" class="file-label">
        <span class="file-label-text"> Upload an audio file </span>
        <input type="file" id="audioFile" name="file" accept="audio/*" required class="file-input hidden" />
      </label>

      <div id="selectedFile" class="selected-file hidden"></div>
      <button type="submit" class="upload-btn">Predict Genre</button>
    </form>

    <div id="status" class="text-indigo-300 mt-6 hidden text-center">Analyzing audio... ðŸŽ¶</div>
    <div id="error" class="text-red-400 mt-2 hidden text-center"></div>

    <!-- Result Box with Glass Effect -->
    <div id="resultBox" class="mt-10 p-6 rounded-xl glassmorphism-effect hidden">
      <p class="text-xl font-semibold text-center mb-4">Genre Prediction Results</p>
      <canvas id="genreChart" class="mb-6 max-h-[400px]"></canvas>
    </div>
  </div>

  <script>
    const form = document.getElementById("uploadForm");
    const statusDiv = document.getElementById("status");
    const errorDiv = document.getElementById("error");
    const genreChart = document.getElementById("genreChart");
    const resultBox = document.getElementById("resultBox");
    const selectedFile = document.getElementById("selectedFile");
    let chartInstance = null;

    document.getElementById("audioFile").addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        selectedFile.textContent = ` ðŸŽµ Selected File : ${file.name} ðŸŽµ`;
        selectedFile.classList.remove("hidden");
      } else {
        selectedFile.classList.add("hidden");
      }
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusDiv.classList.remove("hidden");
      errorDiv.classList.add("hidden");
      resultBox.classList.add("hidden");

      const formData = new FormData();
      formData.append("file", document.getElementById("audioFile").files[0]);

      try {
        const response = await fetch("/predict", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();
        statusDiv.classList.add("hidden");

        if (data.error) {
          errorDiv.textContent = data.error;
          errorDiv.classList.remove("hidden");
        } else {
          const labels = Object.keys(data);
          const values = Object.values(data);
          const radarColors = {
            border: "#6366f1",
            point: "#93c5fd",
            bg: "rgba(99, 102, 241, 0.2)"
          };

          if (chartInstance) chartInstance.destroy();

          chartInstance = new Chart(genreChart, {
            type: 'radar',
            data: {
              labels: labels,
              datasets: [{
                label: 'Genre Confidence',
                data: values,
                fill: true,
                backgroundColor: radarColors.bg,
                borderColor: radarColors.border,
                pointBackgroundColor: radarColors.point,
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: radarColors.border
              }]
            },
            options: {
              responsive: true,
              scales: {
                r: {
                  angleLines: { color: '#4b5563' },
                  grid: { color: '#374151' },
                  pointLabels: {
                    color: '#e5e7eb',
                    font: { size: 13 }
                  },
                  ticks: {
                    beginAtZero: true,
                    color: '#a5b4fc',
                    backdropColor: 'transparent'
                  }
                }
              },
              plugins: {
                legend: {
                  display: false
                },
                tooltip: {
                  callbacks: {
                    label: ctx => `${ctx.label}: ${ctx.raw.toFixed(2)}%`
                  }
                }
              }
            }
          });

          resultBox.classList.remove("hidden");
        }

      } catch (err) {
        statusDiv.classList.add("hidden");
        errorDiv.textContent = "An error occurred. Please try again.";
        errorDiv.classList.remove("hidden");
      }
    });
  </script>

  <nav class="navbar glassmorphism-effect w-full py-4 shadow-md fixed top-0 left-0 z-50">
    <div class="text-center">
      <h1 class="text-2xl font-orbitron text-indigo-300 tracking-widest">
        ViboSonic <span class="font-sans text-indigo-100">: An audio genre classification system</span>
      </h1>
    </div>
  </nav>
</body>
</html>
